<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>麻将胡牌之查表法后续之牌型分析即番数判定</title><link rel="shortcut icon" href="/images/avatar.png"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css"><script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script></head><body><nav class="main-nav"><a href="/">Home</a><a href="/archives">Archives</a></nav><div class="profile"><section id="wrapper"><header id="header"><img class="4x" id="avatar" src="/images/avatar.png"><h2>天生我柴</h2><h4>庸人自扰</h4><h1></h1><h2></h2></header></section></div><section class="post" id="wrapper"><article><header><h1>麻将胡牌之查表法后续之牌型分析即番数判定</h1><h2 class="headline">Mar 14, 2020 9:57·975 words
·4 minutes read<span class="tags"></span></h2></header><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#正文"><span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#胡牌后的牌型分析"><span class="toc-text">胡牌后的牌型分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#番数判定"><span class="toc-text">番数判定</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol></div><section id="post-body"><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>&emsp;&emsp;之前一文有说了麻将胡牌试用压缩后的牌型查表法有奇效，但是麻将并不是一个只判断输赢的游戏，赢要知道赢多大、赢在那里了。<br>这时候就需要进行胡牌后的牌型分析，以便最后的番数判定。标准的胡牌牌型如下：<br>     <div style="width:70%;margin:auto" align="center"><br>    <img src="/2020/03/14/mahjong-fan-cal/paixing.png" title="牌型"><br>    </div><br>  标准的胡牌牌型由四个面子加一个奖牌组成，面子即刻子和顺子。通过观察相关的胡牌番数列表，可以发现胡牌准则中大体上可分为四类：<br>  <em>与玩家的操作相关，例如自摸，门清等。
  </em>与花色相关，例如清一色，混一色等。<br>  <em>与牌型相关，例如平和，四归一等。
  </em>与特定的牌相关，例大三元，小三元，十三幺等。<br>&emsp;&emsp;玩家操作相关的胡法暂且不论，其他的番数判定需要花色、牌型以及特定牌型的组合。  </p>
<h2 id="胡牌后的牌型分析"><a href="#胡牌后的牌型分析" class="headerlink" title="胡牌后的牌型分析"></a>胡牌后的牌型分析</h2><p>&emsp;&emsp;目标是找出胡牌之后当前牌里的刻子（三个一样的牌），顺子（三张连续的牌），杠子（四张一样的牌）以及将牌。理想情况下每个面子及将牌之间都不重叠的话，直接遍历取值就完事了，<br>可现实是骨感的，顺子和刻子以及将牌是有可能重叠在一起的，这种情况下就比较棘手了。遇事不决，暴力拆解，在找到更好方法之前也是这样了。<br>&emsp;&emsp;因为可能有重叠的情况，想一次便利同时找刻子，顺子，奖牌的方法行不通，只能一个一个找。因为可能有重叠，所以查找顺序应该是从小到大，先找奖牌，其次找顺子，刻子（平级，先找顺子和先找刻子都要试试，杠子算特殊的刻子）。程序流程图如下：<br>    <div style="width:70%;margin:auto" align="center"><br>    <img src="/2020/03/14/mahjong-fan-cal/liucheng.png" title="牌型"><br>    </div> </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> def analysis(p):</span><br><span class="line">ret = &#123;&#125;	</span><br><span class="line">for i in tiles:</span><br><span class="line">	for ke_shun in range(2):</span><br><span class="line">		jiang = 0</span><br><span class="line">		kezi = []</span><br><span class="line">		shunzi = []</span><br><span class="line">		gang = []</span><br><span class="line">		t = []</span><br><span class="line">		t = p.copy()</span><br><span class="line">		if t[i] &gt;= 2:</span><br><span class="line">			t[i] -= 2</span><br><span class="line">			jiang = i</span><br><span class="line">			if ke_shun == 0:</span><br><span class="line">				for j in tiles:</span><br><span class="line">					if t[j] &gt;= 3:</span><br><span class="line">						if t[j] == 3:</span><br><span class="line">							kezi.append(j)</span><br><span class="line">						if t[j] == 4:</span><br><span class="line">							gang.append(j)</span><br><span class="line">						t[j] -= t[j]</span><br><span class="line">				for a in range(3):</span><br><span class="line">					b = 0</span><br><span class="line">					while b&lt;7:</span><br><span class="line">						if not sum(i == 0 for i in t[9*a+b:9*a+b+3]):</span><br><span class="line">							t[9*a+b:9*a+b+3] = [x-1 for x in t[9*a+b:9*a+b+3]]</span><br><span class="line">							shunzi.append(9*a+b)</span><br><span class="line">						else:</span><br><span class="line">							b += 1</span><br><span class="line">			else:</span><br><span class="line">				for a in range(3):</span><br><span class="line">					b = 0</span><br><span class="line">					while b&lt;7:</span><br><span class="line">						if not sum(i == 0 for i in t[9*a+b:9*a+b+3]):</span><br><span class="line">							t[9*a+b:9*a+b+3] = [x-1 for x in t[9*a+b:9*a+b+3]]</span><br><span class="line">							shunzi.append(9*a+b)</span><br><span class="line">						else:</span><br><span class="line">							b += 1</span><br><span class="line">				for j in tiles:</span><br><span class="line">					if t[j] &gt;= 3:</span><br><span class="line">						if t[j] == 3:</span><br><span class="line">							kezi.append(j)</span><br><span class="line">						if t[j] == 4:</span><br><span class="line">							gang.append(j)</span><br><span class="line">						t[j] -= t[j]</span><br><span class="line">			if t==[0]*34:</span><br><span class="line">				ret[&apos;shunzi&apos;] = shunzi</span><br><span class="line">				ret[&apos;kezi&apos;]  = kezi</span><br><span class="line">				ret[&apos;gangzi&apos;] = gang</span><br><span class="line">				ret[&apos;jiang&apos;] = jiang</span><br><span class="line">				break</span><br><span class="line">return ret</span><br></pre></td></tr></table></figure>
<p>  测试:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">test = [</span><br><span class="line">                </span><br><span class="line">                MAN2,MAN3,MAN4,</span><br><span class="line">				MAN3,MAN4,MAN5,</span><br><span class="line">				MAN4,MAN5,MAN6,</span><br><span class="line">				MAN5,MAN6,MAN7,</span><br><span class="line">				MAN1,MAN1,</span><br><span class="line">]</span><br><span class="line">print(analysis(tilestoint(test)))</span><br></pre></td></tr></table></figure></p>
<p>输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&apos;shunzi&apos;: [1, 2, 3, 4], &apos;kezi&apos;: [], &apos;gangzi&apos;: [], &apos;jiang&apos;: 0&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="番数判定"><a href="#番数判定" class="headerlink" title="番数判定"></a>番数判定</h2><p>以小三元，清一色，和碰碰胡为例：  </p>
<div style="width:70%;margin:auto" align="center"><br><img src="/2020/03/14/mahjong-fan-cal/pengpenghu.png" title="牌型"><br></div>  

<p>判断条件：胡牌前提下，没有顺子。之前的胡牌查表法中，牌组已经进行了处理，顺子即1,1,1。没有顺子即没有1。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if 1 not in tiles:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure></p>
<p><div style="width:70%;margin:auto" align="center"><br><img src="/2020/03/14/mahjong-fan-cal/xiaosanyuan.png" title="牌型"><br></div><br>判断条件：胡牌前提下，中发白中有两个刻子一个将牌，中发白牌数相加要大于8且其中一个个数为2。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if sum(tiles[-3::])&gt;=8:</span><br><span class="line">		for i in tiles[-3::]:</span><br><span class="line">			if i == 2 :</span><br><span class="line">                pass</span><br></pre></td></tr></table></figure></p>
<p><div style="width:70%;margin:auto" align="center"><br><img src="/2020/03/14/mahjong-fan-cal/qingyise.png" title="牌型"><br></div><br>判断条件：胡牌前提下，所有牌属于一个花色（区间），排序之后比较第一个牌和最后一个牌是否同属一个区间。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for i in range(3):</span><br><span class="line">	if 9*i&lt;=a[0] and a[-1] &lt;= 8*(i+1):</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/hslsdl123456/mahjong-algorithm_demo" target="_blank" rel="noopener">完整源码</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>1.<a href="https://zh.wikipedia.org/wiki/%E5%BB%A3%E6%9D%B1%E9%BA%BB%E9%9B%80%E8%83%A1%E7%89%8C%E5%88%97%E8%A1%A8" target="_blank" rel="noopener"> 廣東麻雀胡牌列表.wikipedia</a><br>2.<a href="http://hp.vector.co.jp/authors/VA046927/mjscore/ptn.rb" target="_blank" rel="noopener">麻雀点数計算アプレット(mjscore).山岡忠夫</a></p>
</section><nav id="post-nav"><span class="prev"></span><span class="next"><a href="/2020/02/18/videoshot-crawler/">Older Posts<span class="arrow">→</span></a></span></nav><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
id:  '麻将胡牌之查表法后续之牌型分析即番数判定',
owner: 'hslsdl123456',
repo: 'test',
oauth: {
    client_id: '18f6cfbface82f7213b7',
    client_secret: '31b6012408c0085c3462a665438c32530e3959d7',
},
})
gitment.render('container')</script></article></section><footer id="footer"><p class="small">Powered by &nbsp;<a href="https://hexo.io/">Hexo &nbsp;</a></p></footer><script>hljs.initHighlightingOnLoad();</script></body></html>